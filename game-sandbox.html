<!DOCTYPE html>
<html>
    <head>
        <title>Development Sandbox</title>
    </head>
    <body>
        <div id='performance-board'>
            <p><span id='canvas-fps'>-</span> fps</p>
            <p>Rendering time : <span id='canvas-render-time'></span>s</p>
            <p>Rendering uptime : <span id='canvas-render-uptime'></span>s</p>
        </div>
        <div>
            <p>
                Press right or left arrow to test canvas interaction
            </p>
        </div>
        <canvas id="game-playground" width="800" height="600">
            <p>
            Your browser does not support canvas feature, please use a more recent browser
            </p>
        </canvas>
        <script src="js/character/utilities.js"></script>
        <script src="js/character/data.js"></script>
        <script src="js/character/model.js"></script>
        <script src="js/character/graphic.js"></script>
        <script src="js/character/engine.js"></script>
        <!-- support for jQuery is not for the game but to ease the manipulation in the playground -->
        <script src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script>
            var parametersMario = {
                name : 'mario',
                position : {
                    x : 10,
                    y : 0,
                    layer : 1
                },
                type : gameData.CHARACTER_TYPES.HERO
            },
            parametersLink = {
                name : 'link',
                position : {
                    x : 10,
                    y : 0,
                    layer : 1
                },
                type : gameData.CHARACTER_TYPES.HERO
            },
            mario,
            link,
            probeEvent = function probe(copyReference){
                console.log(
                'Caller is ', copyReference.name
                );
            },
            moveEvent = function move(copyReference){
                copyReference.position.y -= 15;
            },
            copyIsolationEvent = function copyIsolation(copyReference){
                copyReference.condition.life -= 15;
            },
            marioSpriteMapPath = 'images/mario-sprites-map',
            marioMapLocations = {
                STANDING_RIGHT : {
                    spriteType : 'sequence',
                    sequence : []
                }
            },
            indexAbscissa,
            indexOrdinate,
            imageSegment,
            ctx = document.getElementById('game-playground').getContext('2d');

            var marioImages = [],
            imageDimension = {
                width : 128,
                height : 56,
            },
            spriteDimension = {
                width : 16,
                height : 28
            };
            //create mario sprite map slicing
            for (indexOrdinate = 0;
                indexOrdinate < (imageDimension.height / spriteDimension.height);
                indexOrdinate++) {
                for (indexAbscissa = 0;
                    indexAbscissa < (imageDimension.width / spriteDimension.width);
                    indexAbscissa++) {
                    marioImages.push({
                        type : 'single',
                        x : indexAbscissa * spriteDimension.width,
                        y : indexOrdinate * spriteDimension.height,
                        width : spriteDimension.width,
                        height : spriteDimension.height
                    });
                }
            }

            var marioSpriteMapPath = 'images/mario-sprites-map.png',
            marioSlicing = {
                '0' : marioImages[6],
                '1' : marioImages[0],
                '2' : {
                    type : 'sequence',
                    current : undefined,
                    //FIXME FUCKING literal array which doesn't want to tell its length...
                    size : 4,
                    sequence : [
                        marioImages[1],
                        marioImages[2],
                        marioImages[3],
                        marioImages[4]
                    ]
                },
                '3' : marioImages[5],
                '-1' : marioImages[8],
                '-2' : {
                    type : 'sequence',
                    current : undefined,
                    //FIXME FUCKING literal array which doesn't want to tell its length...
                    size : 4,
                    sequence : [
                        marioImages[9],
                        marioImages[10],
                        marioImages[11],
                        marioImages[12]
                    ]
                },
                '-3' : marioImages[13]
            };

            var mario = characterModelGenerator(parametersMario),
            visualMario = characterVisualGenerator(
                mario,
                marioSpriteMapPath,
                marioSlicing
            );

            //raw key events
            $('body').keydown(function(event){
                switch(event.keyCode){
                    case 37://left
                        mario.condition.state = gameData.CHARACTER_STATES.MOVING_LEFT;
                        break;
                    case 39://right
                        mario.condition.state = gameData.CHARACTER_STATES.MOVING_RIGHT;
                        break;
                }
            });

            $('body').keyup(function(event){
                switch(event.keyCode){
                    case 37://left
                        mario.condition.state = gameData.CHARACTER_STATES.STANDING_LEFT;
                        break;
                    case 39://right
                        mario.condition.state = gameData.CHARACTER_STATES.STANDING_RIGHT;
                        break;
                }
            });

            //register agent with the engine
            gameEngine.agents.register(mario);

            //launch engine
            gameEngine.rendering.play();



        </script>
    </body>
</html>
